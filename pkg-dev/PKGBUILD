# Maintainer: Lukas Heindl <oss.heindl@protonmail.com>
pkgname=st-dev
pkgver=1.0.0
pkgrel=1
pkgdesc="Customized version of st build from git dev"
arch=('x86_64')
url="https://github.com/atticus-sullivan/st"
license=('MIT')
makedepends=('gcc' 'make')
provides=('st')
conflicts=('st')
source=("${pkgname}::git+${url}.git#branch=dev")
sha256sums=('SKIP')

pkgver() {
	cd "${pkgname}"
	git rev-parse --short HEAD
}

build() {
	cd "${pkgname}"
	make
}

package() {
	cd "${pkgname}"

	# Install binaries
	install -Dm755 st "${pkgdir}/usr/local/bin/st"

	# Install man pages
	install -Dm644 st.1 "${pkgdir}/usr/local/man/man1/st.1"

	# Run tic to compile and install the terminfo entry
	install -Dm644 st.info "${pkgdir}/usr/share/terminfo.src/st.info"
}

post_install() {
	# Make sure we're installing the terminfo entry
	if [ -f "${pkgdir}/usr/share/terminfo.src/st.info" ]; then
		msg "Installing terminfo entry for st..."
		tic -sx "${pkgdir}/usr/share/terminfo.src/st.info"
	fi
}
